<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css?v=1.0.5">
  <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
  <meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="Client Portal">
  <link rel="manifest" href="/CPAS/roxi112/manifest.json">
  <link rel="icon" href="https://abihasofto.xyz/CPAS/roxi112/icon-512.png" type="image/png">
  <link rel="apple-touch-icon" sizes="152x152" href="https://abihasofto.xyz/CPAS/roxi112/icon-512.png">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
 <meta name="theme-color" content="#0097e1">
  <title>Customer Preview</title>
  <style>
    body {
  font-family: Arial, sans-serif;
  margin: 0;
  background: #f4f4f4;
  overflow-x: hidden; /* ðŸ‘ˆ prevent page-wide horizontal scroll */
}

    .hidden {
      display: none !important;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

   .sidebar-transition {
    transition: transform 0.3s ease-in-out, width 0.3s ease-in-out;
    }
    .content-transition {
      transition: margin-left 0.3s ease-in-out;
    }


  </style>

</head>
<body class="bg-gray-100">

  <!-- Topbar (All Devices) -->
  <div class="text-white flex items-center sticky top-0 z-[9999] justify-between px-4 py-3 bg-[#0097e1]" >
  <div class="text-xl font-bold"><img style="width:70px;" src="https://abihasofto.xyz/CPAS/roxi112/loading.png" alt="Abiha Softo"></div>
    <div class="text-xl font-bold">Customer Preview</div>
    <button onclick="toggleSidebar()" class="space-y-1">
      <i class="fa fa-bars text-2xl"></i>
    </button>
  </div>

  <div class="flex">

    <!-- Sidebar -->
    <aside id="sidebar"
      class="sidebar-transition fixed top-0 left-0 h-full bg-[#0097e1] text-white p-4 space-y-4 w-64 overflow-hidden lg:fixed z-40 h-screen">

      <div id="sidebarContent">

  <img style="width:70px;" src="https://abihasofto.xyz/CPAS/roxi112/loading.png" alt="Abiha Softo">
         
<div class="p-2 rounded-lg w-full max-w-md text-center space-y-4 mt-20">
    
    <!-- QR Code -->
    <img src="https://png.pngtree.com/png-vector/20250105/ourmid/pngtree-smiley-face-says-thanks-png-image_15064888.png">
    <canvas id="qr" class="mx-auto"></canvas>
    <h2 class="text-l uppercase font-bold mb-2">Thank You For Your Order</h2>

    <!-- Link & Copy Section -->
    <div class="relative">
      <input id="linkInput" type="text" readonly
        class="w-full border rounded p-2 pr-20 text-center text-blue-600 font-medium cursor-pointer"
        value="google.com" onclick="copyLink()" />
      <button onclick="copyLink()" class="absolute right-2 top-1/2 -translate-y-1/2 bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700 text-sm">
        Copy
      </button>
    </div>

  </div>

    <!-- Copied Text -->
    <p id="copiedMsg" class="text-white-600 font-bold hidden">Link Copied!</p>
  </div>

         <span class="text-white-600 text-sm fixed" style="bottom: 5px;"><i>Version 1.0.0</i></span>
      </div>
    </aside>

    <!-- Overlay for mobile/tablet -->
    <div id="overlay" class="fixed inset-0 bg-black bg-opacity-50 hidden z-30" onclick="toggleSidebar()"></div>

    <!-- Main content -->
    <main id="mainContent" class="flex-1 p-6 content-transition lg:ml-64 overflow-x-hidden">
   
    
   <div bis_skin_checked="1" class="flex justify-between">
    <button onclick="hardRefresh()" style="color:#0097e1; border:none;">Refresh <i class="fa fa-refresh transition-transform duration-300 hover:animate-spin cursor-pointer text-xl" onclick="hardRefresh()" title="Refresh"></i></button></div>
        
  <div class="p-4 max-w-2xl mx-auto">
    <div id="customerPreview" class="bg-white p-4 rounded shadow"></div>
  </div>


<div>
  <p class="mt-3 italic text-center text-gray-500">You can Take, Print & Submit the Orders</p> 
  <p class="text-center uppercase">Powered By<a href="https://abihasofto.xyz/" target="_blank" class="text-[#0097e1] hover:text-blue-700 uppercase"> Abiha Softo </a></p>
  </div>
 
    </main>

<script>
  let sidebarOpen = window.innerWidth >= 1024;

  function toggleSidebar() {
    const sidebar = document.getElementById('sidebar');
    const sidebarContent = document.getElementById('sidebarContent');
    const overlay = document.getElementById('overlay');
    const mainContent = document.getElementById('mainContent');

    sidebar.classList.toggle('w-64');
    sidebar.classList.toggle('w-0');
    sidebar.classList.toggle('-translate-x-full');

    sidebarContent.classList.toggle('opacity-0');
    sidebarContent.classList.toggle('pointer-events-none');

    if (window.innerWidth >= 1024) {
      mainContent.classList.toggle('lg:ml-64');
    } else {
      overlay.classList.toggle('hidden');
    }

    sidebarOpen = !sidebarOpen;
  }

  // âœ… Fix: ensure sidebar stays hidden on mobile/tab when page loads
  document.addEventListener('DOMContentLoaded', () => {
    if (window.innerWidth < 1024) {
      const sidebar = document.getElementById('sidebar');
      const sidebarContent = document.getElementById('sidebarContent');
      const overlay = document.getElementById('overlay');

      sidebar.classList.add('-translate-x-full');
      sidebar.classList.add('w-0');
      sidebar.classList.remove('w-64');

      sidebarContent.classList.add('opacity-0');
      sidebarContent.classList.add('pointer-events-none');

      overlay.classList.add('hidden');
    } 
  }); 


</script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js?v=1.0.8"></script>
<script>
   const API_URL = "https://script.google.com/macros/s/AKfycby_dcdxa11mxd14S1Uvd7m9hQR-FKgGh3jYMu0emhBFiw5FAbpM7oa7smACeZUJQMod0A/exec";
            
    function loadCustomerPreview() {
  fetch(API_URL + "?action=getCustomerOrder")
    .then(res => res.json())
    .then(data => {
      console.log("ðŸ“¦ Preview Data:", data);
      let html = `<h3 class="text-lg font-semibold mb-2">Order Preview</h3><ul class="mb-4">`;

      data.items?.forEach(i => {
        const sauces = Array.isArray(i.sauces) ? i.sauces.join(', ') : i.sauces || "";
        const extras = Array.isArray(i.extras) ? i.extras.join(', ') : i.extras || "";

        html += `
          <li class="mb-2">
            <strong>${i.name}</strong> - $ ${i.price}
            ${sauces ? `<br><span class="text-sm text-gray-600"><b>Sauce:</b> ${sauces}</span>` : ''}
            ${extras ? `<br><span class="text-sm text-gray-600"><b>Extras:</b> ${extras}</span>` : ''}
          </li>
        `;
      });

      html += `</ul><p class="font-semibold">Total: $ ${data.total}</p>`;
      if (data.notes) html += `<p class="text-sm italic mt-2"><b>Note:</b> ${data.notes}</p>`;

      document.getElementById("customerPreview").innerHTML = html;
    });
}


  setInterval(loadCustomerPreview, 3000); // every 3s
   

</script>

<script>
function hardRefresh() {
  const url = window.location.href.split('?')[0]; // remove old query if exists
  const cacheBuster = '?v=' + new Date().getTime(); // unique value
  window.location.href = url + cacheBuster;
}
</script>
  <script>
    const link = document.getElementById("linkInput").value;

    // Generate QR code
    new QRious({
      element: document.getElementById("qr"),
      value: link,
      size: 160
    });

    function copyLink() {
      const input = document.getElementById("linkInput");
      input.select();
      input.setSelectionRange(0, 99999); // Mobile
      document.execCommand("copy");

      const msg = document.getElementById("copiedMsg");
      msg.classList.remove("hidden");

      // Hide after 2 seconds
      setTimeout(() => msg.classList.add("hidden"), 2000);
    }
  </script>


  <!-- Loader -->
  <div id="globalLoader" class="fixed inset-0 z-50 flex items-center justify-center hidden">
    <div class="relative flex items-center justify-center" style="position: absolute; bottom: 60px; right: 30px;">
      <div class="absolute w-28 h-28 border-4 border-[#0097e1] border-dashed rounded-full animate-spin"></div>
      <img class="animate-zoom" style=" max-width: 88px;" src="https://abihasofto.xyz/CPAS/roxi112/loading.png" alt="Abiha Softo">
    </div>
  </div>

  <!-- Styles -->
  <style>
    @keyframes zoom {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.15); }
    }
    .animate-zoom {
      animation: zoom 1s ease-in-out infinite;
    }
  </style>

  <!-- Loader Script -->
  <script>
    function showLoader() {
      document.getElementById("globalLoader").classList.remove("hidden");
    }
    function hideLoader() {
      document.getElementById("globalLoader").classList.add("hidden");
    }

    const originalFetch = window.fetch;
    window.fetch = function (...args) {
      showLoader();
      return originalFetch(...args)
        .then(res => {
          hideLoader();
          return res;
        })
        .catch(err => {
          hideLoader();
          throw err;
        });
    };
  </script>

</body>
</html>
